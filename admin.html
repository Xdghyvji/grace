<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Grace Academy - Admin Panel</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #888; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #555; }
        .sidebar { transition: transform 0.3s ease-in-out; }
        .sidebar.hidden-mobile { transform: translateX(-100%); }
        @media (min-width: 1024px) { .sidebar.hidden-mobile { transform: translateX(0); } }
        .fade-in { animation: fadeIn 0.5s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        #loading-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(255, 255, 255, 0.95); display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 9999; }
        .loader { border: 8px solid #f3f3f3; border-top: 8px solid #3B82F6; border-radius: 50%; width: 60px; height: 60px; animation: spin 2s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .active-link { background-color: #1D4ED8; color: white; }
    </style>
</head>
<body class="font-sans antialiased text-gray-800 bg-gray-50 flex min-h-screen">

    <div id="loading-overlay">
        <div class="loader"></div>
        <p id="loading-text" class="mt-4 text-lg text-gray-700">Loading Admin Panel...</p>
    </div>

    <aside id="sidebar" class="sidebar bg-gradient-to-br from-blue-700 to-blue-900 text-white w-64 p-6 space-y-6 flex flex-col hidden-mobile fixed inset-y-0 left-0 lg:relative lg:translate-x-0 z-40 shadow-lg">
        <!-- Sidebar content injected via JS -->
    </aside>

    <div class="flex-1 flex flex-col">
        <header class="bg-white shadow-md p-4 flex justify-between items-center lg:hidden sticky top-0 z-30">
            <button id="sidebar-toggle" class="text-blue-700 focus:outline-none">
                <svg class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
            </button>
            <h1 class="text-2xl font-bold text-blue-900">Admin Panel</h1>
            <div class="flex items-center space-x-3">
                <span class="font-medium text-gray-700 hidden sm:block" id="topbar-admin-name">Admin</span>
                <img id="topbar-admin-img" src="https://placehold.co/40x40/FF0000/FFFFFF?text=A" alt="Admin Profile" class="h-10 w-10 rounded-full border-2 border-red-500">
            </div>
        </header>

        <main class="flex-1 p-6 lg:p-10 bg-gray-50">
            <section id="dashboard" class="hidden"></section>
            <section id="manage-students" class="hidden"></section>
            <section id="manage-teachers" class="hidden"></section>
            <section id="manage-attenders" class="hidden"></section>
            <section id="manage-classes" class="hidden"></section>
            <section id="fee-management" class="hidden"></section>
            <section id="payment-settings" class="hidden"></section>
            <section id="manage-announcements" class="hidden"></section>
            <section id="manage-blog" class="hidden"></section>
            <section id="manage-assignments" class="hidden"></section>
        </main>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, updateDoc, deleteDoc, collection, onSnapshot, addDoc, query, orderBy, serverTimestamp, writeBatch, where } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

       const firebaseConfig = {
  apiKey: "AIzaSyBPyGJ_qX58Ye3Z8BTiKnYGNMYROnyHlGA",
  authDomain: "mubashir-2b7cc.firebaseapp.com",
  projectId: "mubashir-2b7cc",
  storageBucket: "mubashir-2b7cc.firebasestorage.app",
  messagingSenderId: "107494735119",
  appId: "1:107494735119:web:c686025b749196d39e527a",
  measurementId: "G-J1WMVSB6J4"
};
        
        const loadingOverlay = document.getElementById('loading-overlay');
        const loadingText = document.getElementById('loading-text');

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        let studentsCache = [];
        let teachersCache = [];
        let attendersCache = [];
        let classesCache = [];
        let announcementsCache = [];
        let blogPostsCache = [];
        let assignmentsCache = [];
        let paymentRequestsCache = [];

        onAuthStateChanged(auth, async (user) => {
            if (user && !user.isAnonymous) {
                try {
                    const userDocRef = doc(db, "users", user.uid);
                    const userDoc = await getDoc(userDocRef);

                    if (userDoc.exists() && userDoc.data().role === 'admin') {
                        const adminData = userDoc.data();
                        document.getElementById('topbar-admin-name').textContent = adminData.name || 'Administrator';
                        document.getElementById('topbar-admin-img').src = adminData.profileImageUrl || `https://placehold.co/40x40/FF0000/FFFFFF?text=${(adminData.name || 'A').charAt(0)}`;
                        
                        populateUI();
                        initializeListeners();
                        showSection('dashboard');
                    } else {
                        loadingText.textContent = 'Access Denied. You are not an admin.';
                        setTimeout(() => { signOut(auth).then(() => window.location.href = 'login.html'); }, 2000);
                    }
                } catch (error) {
                    console.error("Admin Load Error", error);
                    loadingText.textContent = 'System Error. Check Console.';
                }
            } else {
                window.location.href = 'login.html';
            }
        });

        function populateUI() {
            document.getElementById('sidebar').innerHTML = `
                <div class="flex items-center space-x-3 border-b border-blue-600 pb-4">
                    <img src="download (2).png" alt="Academy Logo" class="h-12 w-auto bg-white rounded-full">
                    <span class="text-2xl font-bold tracking-tight">Admin Panel</span>
                </div>
                <nav class="flex-1 space-y-2">
                    <a href="#dashboard" class="flex items-center space-x-3 px-4 py-2 rounded-lg text-lg hover:bg-blue-600 transition duration-200"><i class="fas fa-tachometer-alt w-6"></i><span>Dashboard</span></a>
                    <div class="border-t border-blue-600 pt-4 mt-4"></div>
                    <p class="text-blue-200 text-sm uppercase font-semibold pl-4 pt-2">Users</p>
                    <a href="#manage-students" class="flex items-center space-x-3 px-4 py-2 rounded-lg text-lg hover:bg-blue-600 transition duration-200"><i class="fas fa-user-graduate w-6"></i><span>Students</span></a>
                    <a href="#manage-teachers" class="flex items-center space-x-3 px-4 py-2 rounded-lg text-lg hover:bg-blue-600 transition duration-200"><i class="fas fa-chalkboard-teacher w-6"></i><span>Teachers</span></a>
                    <a href="#manage-attenders" class="flex items-center space-x-3 px-4 py-2 rounded-lg text-lg hover:bg-blue-600 transition duration-200"><i class="fas fa-clipboard-check w-6"></i><span>Attenders</span></a>
                    <a href="#manage-classes" class="flex items-center space-x-3 px-4 py-2 rounded-lg text-lg hover:bg-blue-600 transition duration-200"><i class="fas fa-school w-6"></i><span>Classes</span></a>
                    <div class="border-t border-blue-600 pt-4 mt-4"></div>
                    <p class="text-blue-200 text-sm uppercase font-semibold pl-4 pt-2">Finance</p>
                    <a href="#fee-management" class="flex items-center space-x-3 px-4 py-2 rounded-lg text-lg hover:bg-blue-600 transition duration-200"><i class="fas fa-file-invoice-dollar w-6"></i><span>Fees & Challans</span></a>
                    <a href="#payment-settings" class="flex items-center space-x-3 px-4 py-2 rounded-lg text-lg hover:bg-blue-600 transition duration-200"><i class="fas fa-cogs w-6"></i><span>Settings</span></a>
                    <div class="border-t border-blue-600 pt-4 mt-4"></div>
                    <p class="text-blue-200 text-sm uppercase font-semibold pl-4 pt-2">Content</p>
                    <a href="#manage-announcements" class="flex items-center space-x-3 px-4 py-2 rounded-lg text-lg hover:bg-blue-600 transition duration-200"><i class="fas fa-bullhorn w-6"></i><span>Announce</span></a>
                    <a href="#manage-blog" class="flex items-center space-x-3 px-4 py-2 rounded-lg text-lg hover:bg-blue-600 transition duration-200"><i class="fas fa-blog w-6"></i><span>Blog</span></a>
                    <a href="#manage-assignments" class="flex items-center space-x-3 px-4 py-2 rounded-lg text-lg hover:bg-blue-600 transition duration-200"><i class="fas fa-tasks w-6"></i><span>Tasks</span></a>
                </nav>
                <div class="border-t border-blue-600 pt-4">
                    <a href="index.html" class="flex items-center space-x-3 px-4 py-2 rounded-lg text-lg hover:bg-blue-600 transition duration-200"><i class="fas fa-home w-6"></i><span>Home</span></a>
                    <button id="logout-button" class="w-full flex items-center space-x-3 px-4 py-2 rounded-lg text-lg bg-red-600 hover:bg-red-700 transition duration-200 mt-2"><i class="fas fa-sign-out-alt w-6"></i><span>Logout</span></button>
                </div>`;
            
            document.querySelectorAll('.sidebar nav a').forEach(link => { link.addEventListener('click', (e) => { e.preventDefault(); showSection(link.getAttribute('href').substring(1)); }); });
            document.getElementById('logout-button').addEventListener('click', () => signOut(auth));
            document.getElementById('sidebar-toggle').addEventListener('click', () => document.getElementById('sidebar').classList.toggle('hidden-mobile'));
        }

        function showSection(targetId) {
            document.querySelectorAll('main section').forEach(sec => sec.classList.add('hidden'));
            document.querySelectorAll('.sidebar nav a').forEach(link => link.classList.remove('active-link'));
            
            const section = document.getElementById(targetId);
            if (section) {
                section.classList.remove('hidden');
                const navLink = document.querySelector(`.sidebar nav a[href="#${targetId}"]`);
                if(navLink) navLink.classList.add('active-link');

                switch(targetId) {
                    case 'dashboard': renderDashboard(); break;
                    case 'manage-students': renderStudents(); break;
                    case 'manage-teachers': renderTeachers(); break;
                    case 'manage-attenders': renderAttenders(); break;
                    case 'manage-classes': renderClasses(); break;
                    case 'fee-management': renderFeeManagement(); break;
                    case 'payment-settings': renderPaymentSettings(); break;
                    case 'manage-announcements': renderAnnouncements(); break;
                    case 'manage-blog': renderBlogPosts(); break;
                    case 'manage-assignments': renderAssignments(); break;
                }
            }
            if (window.innerWidth < 1024) document.getElementById('sidebar').classList.add('hidden-mobile');
        }

        function initializeListeners() {
            onSnapshot(query(collection(db, 'students'), orderBy('name')), (snapshot) => {
                studentsCache = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                updateDashboardCounts();
                if (!document.getElementById('manage-students').classList.contains('hidden')) renderStudents();
                if (!document.getElementById('fee-management').classList.contains('hidden')) renderFeeManagement();
            });

            onSnapshot(query(collection(db, 'teachers'), orderBy('name')), (snapshot) => {
                teachersCache = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                updateDashboardCounts();
                if (!document.getElementById('manage-teachers').classList.contains('hidden')) renderTeachers();
            });

            onSnapshot(query(collection(db, 'attenders'), orderBy('name')), (snapshot) => {
                attendersCache = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                if (!document.getElementById('manage-attenders').classList.contains('hidden')) renderAttenders();
            });

            onSnapshot(query(collection(db, 'classes'), orderBy('name')), (snapshot) => {
                classesCache = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                if (!document.getElementById('manage-classes').classList.contains('hidden')) renderClasses();
            });

            onSnapshot(query(collection(db, 'announcements'), orderBy('date', 'desc')), (snap) => { announcementsCache = snap.docs.map(d => ({id:d.id, ...d.data()})); if(!document.getElementById('manage-announcements').classList.contains('hidden')) renderAnnouncements(); });
            onSnapshot(query(collection(db, 'blogPosts'), orderBy('date', 'desc')), (snap) => { blogPostsCache = snap.docs.map(d => ({id:d.id, ...d.data()})); updateDashboardCounts(); if(!document.getElementById('manage-blog').classList.contains('hidden')) renderBlogPosts(); });
            onSnapshot(query(collection(db, 'assignments'), orderBy('dueDate', 'desc')), (snap) => { assignmentsCache = snap.docs.map(d => ({id:d.id, ...d.data()})); updateDashboardCounts(); if(!document.getElementById('manage-assignments').classList.contains('hidden')) renderAssignments(); });
            onSnapshot(query(collection(db, 'paymentRequests'), orderBy('submittedAt', 'desc')), (snap) => { paymentRequestsCache = snap.docs.map(d => ({id:d.id, ...d.data()})); if(!document.getElementById('fee-management').classList.contains('hidden')) renderFeeManagement(); });
            
            setTimeout(() => loadingOverlay.style.display = 'none', 800);
        }

        function updateDashboardCounts(){
             if(document.getElementById('total-students')) document.getElementById('total-students').textContent = studentsCache.length;
             if(document.getElementById('total-teachers')) document.getElementById('total-teachers').textContent = teachersCache.length;
             if(document.getElementById('total-assignments')) document.getElementById('total-assignments').textContent = assignmentsCache.length;
             if(document.getElementById('total-blog-posts')) document.getElementById('total-blog-posts').textContent = blogPostsCache.length;
        }

        function renderDashboard() {
            document.getElementById('dashboard').innerHTML = `
                <div class="bg-white p-8 rounded-lg shadow-xl fade-in">
                    <h2 class="text-4xl font-extrabold text-blue-900 mb-8 border-b-2 border-blue-200 pb-4">Admin Dashboard</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8 mb-12">
                         <div class="bg-blue-50 p-6 rounded-lg shadow-md flex items-center space-x-4 border-l-4 border-blue-600">
                            <i class="fas fa-user-graduate text-blue-600 text-4xl"></i>
                            <div><p class="text-gray-600 text-sm font-semibold">Total Students</p><p class="text-3xl font-bold text-blue-800" id="total-students">${studentsCache.length}</p></div>
                        </div>
                        <div class="bg-green-50 p-6 rounded-lg shadow-md flex items-center space-x-4 border-l-4 border-green-600">
                            <i class="fas fa-chalkboard-teacher text-green-600 text-4xl"></i>
                            <div><p class="text-gray-600 text-sm font-semibold">Total Teachers</p><p class="text-3xl font-bold text-green-800" id="total-teachers">${teachersCache.length}</p></div>
                        </div>
                        <div class="bg-yellow-50 p-6 rounded-lg shadow-md flex items-center space-x-4 border-l-4 border-yellow-600">
                            <i class="fas fa-tasks text-yellow-600 text-4xl"></i>
                            <div><p class="text-gray-600 text-sm font-semibold">Active Assignments</p><p class="text-3xl font-bold text-yellow-800" id="total-assignments">${assignmentsCache.length}</p></div>
                        </div>
                        <div class="bg-purple-50 p-6 rounded-lg shadow-md flex items-center space-x-4 border-l-4 border-purple-600">
                            <i class="fas fa-blog text-purple-600 text-4xl"></i>
                            <div><p class="text-gray-600 text-sm font-semibold">Blog Posts</p><p class="text-3xl font-bold text-purple-800" id="total-blog-posts">${blogPostsCache.length}</p></div>
                        </div>
                    </div>
                </div>`;
        }

        async function createUser(email, password, role, profileData) {
            try {
                const tempApp = initializeApp(firebaseConfig, 'secondary-' + Date.now());
                const tempAuth = getAuth(tempApp);
                const userCredential = await createUserWithEmailAndPassword(tempAuth, email, password);
                const newUser = userCredential.user;

                const batch = writeBatch(db);
                batch.set(doc(db, "users", newUser.uid), { role, email, createdAt: serverTimestamp() });
                
                let collectionName = 'students';
                if(role === 'teacher') collectionName = 'teachers';
                if(role === 'attender') collectionName = 'attenders';

                batch.set(doc(db, collectionName, newUser.uid), { ...profileData, email, uid: newUser.uid });

                await batch.commit();
                await signOut(tempAuth);
                return true;
            } catch (error) {
                console.error(`Error creating ${role}:`, error);
                alert(`Error: ${error.message}`);
                return false;
            }
        }

        // --- Students ---
        function renderStudents() {
            const section = document.getElementById('manage-students');
            section.innerHTML = `
                <div class="bg-white p-8 rounded-lg shadow-xl fade-in">
                    <h2 class="text-4xl font-extrabold text-blue-900 mb-8 border-b-2 border-blue-200 pb-4">Manage Students</h2>
                    <button id="add-student-btn" class="bg-blue-600 hover:bg-blue-700 text-white px-5 py-2 rounded-lg font-medium mb-6 transition shadow-md">Add New Student</button>
                    <div id="student-form-container" class="hidden bg-blue-50 p-6 rounded-lg shadow-inner mb-8 border border-blue-100"></div>
                    <div class="overflow-x-auto">
                        <table class="min-w-full bg-white rounded-lg shadow-md">
                            <thead class="bg-blue-600 text-white"><tr><th class="py-3 px-4 text-left">Name</th><th class="py-3 px-4 text-left">Roll No</th><th class="py-3 px-4 text-left">Class</th><th class="py-3 px-4 text-left">Actions</th></tr></thead>
                            <tbody id="student-list-body" class="divide-y divide-gray-200"></tbody>
                        </table>
                    </div>
                </div>`;
            const listBody = section.querySelector('#student-list-body');
            listBody.innerHTML = studentsCache.map(student => {
                const className = classesCache.find(c => c.id === student.classId)?.name || 'N/A';
                return `<tr class="hover:bg-blue-50 transition"><td class="py-3 px-4 font-medium">${student.name}</td><td class="py-3 px-4">${student.rollNo}</td><td class="py-3 px-4">${className}</td><td class="py-3 px-4"><button class="edit-student-btn text-blue-600 mr-3" data-id="${student.id}"><i class="fas fa-edit"></i></button><button class="delete-student-btn text-red-600" data-id="${student.id}"><i class="fas fa-trash"></i></button></td></tr>`}).join('');
            
            section.querySelector('#add-student-btn').addEventListener('click', () => showStudentForm());
            section.querySelectorAll('.edit-student-btn').forEach(btn => btn.addEventListener('click', (e) => showStudentForm(e.currentTarget.dataset.id)));
            section.querySelectorAll('.delete-student-btn').forEach(btn => btn.addEventListener('click', (e) => deleteStudent(e.currentTarget.dataset.id)));
        }

        function showStudentForm(id = null) {
            const student = id ? studentsCache.find(s => s.id === id) : {};
            const container = document.getElementById('student-form-container');
            container.classList.remove('hidden');
            const classOptions = classesCache.map(c => `<option value="${c.id}" ${student.classId === c.id ? 'selected' : ''}>${c.name}</option>`).join('');
            
            container.innerHTML = `
                <h3 class="text-2xl font-bold text-blue-800 mb-4">${id ? 'Edit' : 'Add'} Student</h3>
                <form id="student-form" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <input type="hidden" id="student-id" value="${id || ''}">
                    <div><label class="font-medium">Full Name</label><input type="text" id="student-name" class="w-full p-2 border rounded mt-1" value="${student.name || ''}" required></div>
                    <div><label class="font-medium">Email</label><input type="email" id="student-email" class="w-full p-2 border rounded mt-1" value="${student.email || ''}" required ${id ? 'disabled class="bg-gray-200"' : ''}></div>
                    ${!id ? `<div><label class="font-medium">Password</label><input type="password" id="student-password" class="w-full p-2 border rounded mt-1" placeholder="Min 6 chars" required></div>` : ''}
                    <div><label class="font-medium">Roll No</label><input type="text" id="student-rollNo" class="w-full p-2 border rounded mt-1" value="${student.rollNo || ''}" required></div>
                    <div><label class="font-medium">Class</label><select id="student-classId" class="w-full p-2 border rounded mt-1" required><option value="">Select Class</option>${classOptions}</select></div>
                    <div class="md:col-span-2 flex justify-end space-x-4 mt-4"><button type="button" id="cancel-student-form" class="bg-gray-300 text-gray-800 px-4 py-2 rounded">Cancel</button><button type="submit" class="bg-blue-600 text-white px-6 py-2 rounded shadow">${id ? 'Update' : 'Create'} Student</button></div></form>`;
            document.getElementById('cancel-student-form').addEventListener('click', () => container.classList.add('hidden'));
            document.getElementById('student-form').addEventListener('submit', saveStudent);
        }

        async function saveStudent(e) {
            e.preventDefault();
            const id = document.getElementById('student-id').value;
            const profileData = { name: document.getElementById('student-name').value, rollNo: document.getElementById('student-rollNo').value, classId: document.getElementById('student-classId').value };
            if(id) { await updateDoc(doc(db, 'students', id), profileData); alert('Student updated!'); }
            else { 
                const email = document.getElementById('student-email').value; 
                const password = document.getElementById('student-password').value; 
                if (await createUser(email, password, 'student', profileData)) alert('Student created successfully!'); 
            }
            document.getElementById('student-form-container').classList.add('hidden');
        }

        async function deleteStudent(id) {
            if (confirm('Delete this student?')) { 
                const batch = writeBatch(db);
                batch.delete(doc(db, 'students', id));
                batch.delete(doc(db, "users", id));
                await batch.commit();
                alert('Student record deleted.'); 
            }
        }

        // --- Teachers ---
        function renderTeachers() {
            const section = document.getElementById('manage-teachers');
            section.innerHTML = `
                <div class="bg-white p-8 rounded-lg shadow-xl fade-in">
                    <h2 class="text-4xl font-extrabold text-green-900 mb-8 border-b-2 border-green-200 pb-4">Manage Teachers</h2>
                    <button id="add-teacher-btn" class="bg-green-600 hover:bg-green-700 text-white px-5 py-2 rounded-lg font-medium mb-6 shadow-md">Add New Teacher</button>
                    <div id="teacher-form-container" class="hidden bg-green-50 p-6 rounded-lg shadow-inner mb-8 border border-green-100"></div>
                    <div class="overflow-x-auto"><table class="min-w-full bg-white rounded-lg shadow-md"><thead class="bg-green-600 text-white"><tr><th class="py-3 px-4 text-left">Name</th><th class="py-3 px-4 text-left">Email</th><th class="py-3 px-4 text-left">Actions</th></tr></thead><tbody id="teacher-list-body" class="divide-y divide-gray-200"></tbody></table></div>
                </div>`;
            const listBody = section.querySelector('#teacher-list-body');
            listBody.innerHTML = teachersCache.map(t => `<tr class="hover:bg-green-50 transition"><td class="py-3 px-4 font-medium">${t.name}</td><td class="py-3 px-4 text-gray-600">${t.email}</td><td class="py-3 px-4"><button class="edit-teacher-btn text-blue-600 mr-3" data-id="${t.id}"><i class="fas fa-edit"></i></button><button class="delete-teacher-btn text-red-600" data-id="${t.id}"><i class="fas fa-trash"></i></button></td></tr>`).join('');
            section.querySelector('#add-teacher-btn').addEventListener('click', () => showTeacherForm());
            section.querySelectorAll('.edit-teacher-btn').forEach(btn => btn.addEventListener('click', (e) => showTeacherForm(e.currentTarget.dataset.id)));
            section.querySelectorAll('.delete-teacher-btn').forEach(btn => btn.addEventListener('click', (e) => deleteTeacher(e.currentTarget.dataset.id)));
        }

        function showTeacherForm(id = null) {
            const teacher = id ? teachersCache.find(t => t.id === id) : {};
            const container = document.getElementById('teacher-form-container');
            container.classList.remove('hidden');
            const classCheckboxes = classesCache.map(c => `<label class="flex items-center space-x-2 p-2 bg-white rounded border border-gray-200 cursor-pointer hover:bg-gray-50"><input type="checkbox" class="teacher-class-checkbox" value="${c.id}" ${(teacher.classIds || []).includes(c.id) ? 'checked' : ''}><span class="text-sm font-medium text-gray-700">${c.name}</span></label>`).join('');

            container.innerHTML = `<h3 class="text-2xl font-bold text-green-800 mb-4">${id ? 'Edit' : 'Add'} Teacher</h3><form id="teacher-form" class="grid grid-cols-1 md:grid-cols-2 gap-6"><input type="hidden" id="teacher-id" value="${id || ''}"><div><label class="font-medium">Full Name</label><input type="text" id="teacher-name" class="w-full p-2 border rounded mt-1" value="${teacher.name || ''}" required></div><div><label class="font-medium">Email</label><input type="email" id="teacher-email" class="w-full p-2 border rounded mt-1" value="${teacher.email || ''}" required ${id ? 'disabled' : ''}></div>${!id ? `<div><label class="font-medium">Password</label><input type="password" id="teacher-password" class="w-full p-2 border rounded mt-1" required></div>` : ''}<div class="md:col-span-2"><label class="font-medium block mb-2">Assign Classes</label><div class="grid grid-cols-2 md:grid-cols-4 gap-2">${classCheckboxes}</div></div><div class="md:col-span-2 flex justify-end space-x-4 mt-4"><button type="button" id="cancel-teacher-form" class="bg-gray-300 px-4 py-2 rounded">Cancel</button><button type="submit" class="bg-green-600 text-white px-6 py-2 rounded shadow">${id ? 'Update' : 'Create'} Teacher</button></div></form>`;
            document.getElementById('cancel-teacher-form').addEventListener('click', () => container.classList.add('hidden'));
            document.getElementById('teacher-form').addEventListener('submit', saveTeacher);
        }

        async function saveTeacher(e) {
            e.preventDefault();
            const id = document.getElementById('teacher-id').value;
            const selectedClassIds = Array.from(document.querySelectorAll('.teacher-class-checkbox:checked')).map(cb => cb.value);
            const profileData = { name: document.getElementById('teacher-name').value, classIds: selectedClassIds };
            if(id) { await updateDoc(doc(db, 'teachers', id), profileData); alert('Teacher updated!'); }
            else { const email = document.getElementById('teacher-email').value; const password = document.getElementById('teacher-password').value; if(await createUser(email, password, 'teacher', profileData)) alert('Teacher created!'); }
            document.getElementById('teacher-form-container').classList.add('hidden');
        }

        async function deleteTeacher(id) { if (confirm('Delete this teacher?')) { const batch = writeBatch(db); batch.delete(doc(db, 'teachers', id)); batch.delete(doc(db, "users", id)); await batch.commit(); alert('Teacher record deleted.'); }}

        // --- Attenders (NEW) ---
        function renderAttenders() {
            const section = document.getElementById('manage-attenders');
            section.innerHTML = `
                <div class="bg-white p-8 rounded-lg shadow-xl fade-in">
                    <h2 class="text-4xl font-extrabold text-yellow-900 mb-8 border-b-2 border-yellow-200 pb-4">Manage Attenders</h2>
                    <button id="add-attender-btn" class="bg-yellow-600 hover:bg-yellow-700 text-white px-5 py-2 rounded-lg font-medium mb-6 shadow-md">Add New Attender</button>
                    <div id="attender-form-container" class="hidden bg-yellow-50 p-6 rounded-lg shadow-inner mb-8 border border-yellow-100"></div>
                    <div class="overflow-x-auto"><table class="min-w-full bg-white rounded-lg shadow-md"><thead class="bg-yellow-600 text-white"><tr><th class="py-3 px-4 text-left">Name</th><th class="py-3 px-4 text-left">Email</th><th class="py-3 px-4 text-left">Actions</th></tr></thead><tbody id="attender-list-body" class="divide-y divide-gray-200"></tbody></table></div>
                </div>`;
            const listBody = section.querySelector('#attender-list-body');
            listBody.innerHTML = attendersCache.map(a => `<tr class="hover:bg-yellow-50 transition"><td class="py-3 px-4 font-medium">${a.name}</td><td class="py-3 px-4 text-gray-600">${a.email}</td><td class="py-3 px-4"><button class="delete-attender-btn text-red-600" data-id="${a.id}"><i class="fas fa-trash"></i></button></td></tr>`).join('');
            
            section.querySelector('#add-attender-btn').addEventListener('click', () => showAttenderForm());
            section.querySelectorAll('.delete-attender-btn').forEach(btn => btn.addEventListener('click', (e) => deleteAttender(e.currentTarget.dataset.id)));
        }

        function showAttenderForm() {
            const container = document.getElementById('attender-form-container');
            container.classList.remove('hidden');
            container.innerHTML = `
                <h3 class="text-2xl font-bold text-yellow-800 mb-4">Add Attender</h3>
                <form id="attender-form" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div><label class="font-medium">Full Name</label><input type="text" id="attender-name" class="w-full p-2 border rounded mt-1" required></div>
                    <div><label class="font-medium">Email</label><input type="email" id="attender-email" class="w-full p-2 border rounded mt-1" required></div>
                    <div><label class="font-medium">Password</label><input type="password" id="attender-password" class="w-full p-2 border rounded mt-1" required></div>
                    <div class="md:col-span-2 flex justify-end space-x-4 mt-4"><button type="button" id="cancel-attender-form" class="bg-gray-300 px-4 py-2 rounded">Cancel</button><button type="submit" class="bg-yellow-600 text-white px-6 py-2 rounded shadow">Create Attender</button></div>
                </form>`;
            document.getElementById('cancel-attender-form').addEventListener('click', () => container.classList.add('hidden'));
            document.getElementById('attender-form').addEventListener('submit', saveAttender);
        }

        async function saveAttender(e) {
            e.preventDefault();
            const email = document.getElementById('attender-email').value;
            const password = document.getElementById('attender-password').value;
            const profileData = { name: document.getElementById('attender-name').value };
            
            if(await createUser(email, password, 'attender', profileData)) {
                alert('Attender created!');
                document.getElementById('attender-form-container').classList.add('hidden');
            }
        }

        async function deleteAttender(id) { if (confirm('Delete this attender?')) { const batch = writeBatch(db); batch.delete(doc(db, 'attenders', id)); batch.delete(doc(db, "users", id)); await batch.commit(); alert('Attender record deleted.'); }}

        // --- Classes ---
        function renderClasses() {
            const section = document.getElementById('manage-classes');
            section.innerHTML = `
                <div class="bg-white p-8 rounded-lg shadow-xl fade-in">
                    <h2 class="text-4xl font-extrabold text-purple-900 mb-8 border-b-2 border-purple-200 pb-4">Manage Classes</h2>
                    <form id="add-class-form" class="mb-8 flex items-center space-x-4 max-w-lg">
                        <input type="text" id="class-name" placeholder="Class Name (e.g., Grade 9 - A)" class="flex-1 p-3 border rounded-lg shadow-sm" required>
                        <button type="submit" class="bg-purple-600 text-white py-3 px-6 rounded-lg font-semibold shadow hover:bg-purple-700">Add Class</button>
                    </form>
                    <div id="class-list" class="space-y-3"></div>
                </div>`;
            const list = section.querySelector('#class-list');
            list.innerHTML = classesCache.map(c => `<div class="bg-gray-50 p-4 rounded-lg flex justify-between items-center shadow-sm border border-gray-200"><span class="font-bold text-gray-700 text-lg">${c.name}</span><button class="delete-class-btn text-red-500 hover:text-red-700 bg-white p-2 rounded-full shadow-sm" data-id="${c.id}"><i class="fas fa-trash"></i></button></div>`).join('');
            
            section.querySelector('#add-class-form').addEventListener('submit', async (e) => { e.preventDefault(); await addDoc(collection(db, 'classes'), { name: document.getElementById('class-name').value, createdAt: serverTimestamp() }); document.getElementById('class-name').value = ''; });
            section.querySelectorAll('.delete-class-btn').forEach(b => b.addEventListener('click', async (e) => { if(confirm('Delete class?')) await deleteDoc(doc(db, 'classes', e.currentTarget.dataset.id)); }));
        }

        // --- Fee Management (Updated with Printing) ---
        function renderFeeManagement() {
            const section = document.getElementById('fee-management');
            
            // Student Dropdown for Manual Challan
            const studentOptions = studentsCache.map(s => `<option value='${JSON.stringify(s)}'>${s.name} (${s.rollNo})</option>`).join('');

            section.innerHTML = `
                <div class="bg-white p-8 rounded-lg shadow-xl fade-in">
                    <h2 class="text-4xl font-extrabold text-gray-800 mb-8 border-b pb-4">Fee Management</h2>
                    
                    <!-- Manual Challan Section -->
                    <div class="bg-blue-50 p-6 rounded-lg border border-blue-200 mb-10 shadow-sm">
                        <h3 class="text-2xl font-bold text-blue-900 mb-4 flex items-center"><i class="fas fa-file-invoice mr-2"></i>Generate Fee Challan</h3>
                        <div class="flex flex-col md:flex-row gap-4 items-end">
                            <div class="flex-1 w-full">
                                <label class="block font-medium mb-2 text-gray-700">Select Student (Optional)</label>
                                <select id="challan-student-select" class="w-full p-2 border rounded shadow-sm">
                                    <option value="">-- Blank Challan --</option>
                                    ${studentOptions}
                                </select>
                            </div>
                            <div class="flex-1 w-full">
                                <label class="block font-medium mb-2 text-gray-700">Month/Details</label>
                                <input type="text" id="challan-month" class="w-full p-2 border rounded shadow-sm" placeholder="e.g. October 2023 Fee">
                            </div>
                            <div class="flex-1 w-full">
                                <label class="block font-medium mb-2 text-gray-700">Amount (PKR)</label>
                                <input type="number" id="challan-amount" class="w-full p-2 border rounded shadow-sm" placeholder="Total Amount">
                            </div>
                            <button id="print-challan-btn" class="bg-blue-600 text-white px-6 py-2 rounded font-bold shadow hover:bg-blue-700 transition"><i class="fas fa-print mr-2"></i> Print</button>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-10">
                        <div>
                            <h3 class="text-2xl font-bold text-gray-700 mb-4">Pending Online Requests</h3>
                            <div id="payment-requests-list" class="space-y-4 max-h-[500px] overflow-y-auto"></div>
                        </div>
                        <div>
                            <h3 class="text-2xl font-bold text-gray-700 mb-4">Student Fee Status</h3>
                            <div class="overflow-x-auto border rounded-lg max-h-[500px] overflow-y-auto shadow-sm">
                                <table class="min-w-full bg-white text-sm">
                                    <thead class="bg-gray-700 text-white sticky top-0"><tr><th class="p-3 text-left">Student</th><th class="p-3 text-center">Status</th><th class="p-3 text-center">Action</th></tr></thead>
                                    <tbody id="fee-student-list" class="divide-y"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>`;
            
            // Render Payment Requests
            const requestsList = section.querySelector('#payment-requests-list');
            if (paymentRequestsCache.length === 0) {
                requestsList.innerHTML = '<p class="text-gray-500 italic border p-4 rounded bg-gray-50 text-center">No pending payment requests.</p>';
            } else {
                requestsList.innerHTML = paymentRequestsCache.map(req => `
                    <div class="bg-blue-50 p-4 rounded-lg border border-blue-100 shadow-sm hover:shadow-md transition">
                        <div class="flex justify-between items-start mb-2">
                            <div><p class="font-bold text-blue-900">${req.studentName}</p><p class="text-xs text-gray-500">${req.studentClass}</p></div>
                            <span class="text-xs bg-yellow-200 text-yellow-800 px-2 py-1 rounded">Pending</span>
                        </div>
                        <div class="mb-3"><a href="${req.proofUrl}" target="_blank" class="text-blue-600 hover:underline text-sm"><i class="fas fa-external-link-alt"></i> View Proof</a></div>
                        <div class="flex space-x-2"><button class="approve-payment-btn flex-1 bg-green-600 text-white py-1 rounded hover:bg-green-700 transition" data-req-id="${req.id}" data-student-id="${req.studentId}">Approve</button><button class="reject-payment-btn flex-1 bg-red-600 text-white py-1 rounded hover:bg-red-700 transition" data-req-id="${req.id}">Reject</button></div>
                    </div>`).join('');
            }
            section.querySelectorAll('.approve-payment-btn').forEach(btn => btn.addEventListener('click', e => approvePayment(e.currentTarget.dataset.reqId, e.currentTarget.dataset.studentId)));
            section.querySelectorAll('.reject-payment-btn').forEach(btn => btn.addEventListener('click', e => rejectPayment(e.currentTarget.dataset.reqId)));

            // Render Student Status with PRINT RECEIPT button
            const listBody = section.querySelector('#fee-student-list');
            listBody.innerHTML = studentsCache.map(student => {
                const isPaid = student.feeStatus === 'Paid';
                const statusClass = isPaid ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800';
                return `<tr>
                    <td class="p-3 font-medium">${student.name} <div class="text-xs text-gray-500">${student.rollNo}</div></td>
                    <td class="p-3 text-center"><span class="px-2 py-1 rounded-full text-xs font-semibold ${statusClass}">${student.feeStatus || 'Unpaid'}</span></td>
                    <td class="p-3 text-center flex space-x-2 justify-center">
                        ${!isPaid ? `<button class="mark-paid-btn bg-gray-200 hover:bg-green-500 hover:text-white px-2 py-1 rounded text-xs transition" data-id="${student.id}" title="Mark Paid"><i class="fas fa-check"></i></button>` : ''}
                        <button class="print-receipt-btn bg-blue-100 text-blue-600 hover:bg-blue-600 hover:text-white px-2 py-1 rounded text-xs transition" data-student='${JSON.stringify(student)}' title="Print Receipt"><i class="fas fa-print"></i></button>
                    </td>
                </tr>`;
            }).join('');
            section.querySelectorAll('.mark-paid-btn').forEach(btn => btn.addEventListener('click', e => markAsPaid(e.currentTarget.dataset.id)));
            section.querySelectorAll('.print-receipt-btn').forEach(btn => btn.addEventListener('click', e => printReceipt(JSON.parse(e.currentTarget.dataset.student))));
            
            document.getElementById('print-challan-btn').addEventListener('click', printManualChallan);
        }

        // --- FEE PRINTING LOGIC ---

        function getReceiptHTML(data) {
            const date = new Date().toLocaleDateString();
            return `
            <html><head><title>Fee Receipt - The Grace Academy</title><style>
                body { font-family: 'Helvetica Neue', Arial, sans-serif; padding: 40px; background: #f9f9f9; }
                .receipt-box { background: white; border: 2px solid #333; padding: 30px; max-width: 800px; margin: 0 auto; box-shadow: 0 4px 10px rgba(0,0,0,0.1); position: relative; }
                .header { text-align: center; border-bottom: 3px double #333; padding-bottom: 20px; margin-bottom: 30px; }
                .header img { height: 80px; margin-bottom: 15px; }
                .header h1 { margin: 5px 0; font-size: 28px; text-transform: uppercase; color: #2c3e50; letter-spacing: 1px; }
                .header p { margin: 0; color: #7f8c8d; font-size: 14px; }
                .title { text-align: center; font-size: 20px; font-weight: bold; margin-bottom: 30px; text-decoration: underline; }
                .info-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px; }
                .field { display: flex; align-items: baseline; border-bottom: 1px dotted #999; padding-bottom: 5px; }
                .field strong { font-weight: bold; width: 120px; color: #333; }
                .field span { flex: 1; color: #000; font-weight: 500; font-size: 16px; }
                .amount-box { border: 2px solid #2c3e50; background: #f4f6f7; padding: 15px; text-align: right; font-size: 20px; font-weight: bold; margin-bottom: 60px; border-radius: 5px; }
                .signatures { display: flex; justify-content: space-between; margin-top: 80px; }
                .sig-line { border-top: 1px solid #333; width: 220px; text-align: center; padding-top: 10px; font-size: 14px; color: #555; }
                .watermark { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%) rotate(-45deg); font-size: 100px; color: rgba(0,0,0,0.03); z-index: 0; pointer-events: none; }
                @media print { body { background: white; padding: 0; } .receipt-box { box-shadow: none; border: 1px solid #000; } }
            </style></head>
            <body>
                <div class="receipt-box">
                    <div class="watermark">OFFICIAL</div>
                    <div class="header">
                        <img src="download (2).png" alt="Logo" onerror="this.style.display='none'">
                        <h1>The Grace Academy</h1>
                        <p>Paigah Dera Ghazi Khan | 0336-2268687</p>
                    </div>
                    <div class="title">FEE CHALLAN / RECEIPT</div>
                    <div class="info-grid">
                        <div class="field"><strong>Student Name:</strong> <span>${data.name || ''}</span></div>
                        <div class="field"><strong>Father Name:</strong> <span>__________________</span></div>
                        <div class="field"><strong>Roll No:</strong> <span>${data.rollNo || ''}</span></div>
                        <div class="field"><strong>Class:</strong> <span>${data.className || ''}</span></div>
                        <div class="field"><strong>Issue Date:</strong> <span>${date}</span></div>
                        <div class="field"><strong>Month/Desc:</strong> <span>${data.month || ''}</span></div>
                    </div>
                    <div class="amount-box">
                        Total Amount Received: PKR ${data.amount || ''}
                    </div>
                    <div class="signatures">
                        <div class="sig-line">Accountant Signature</div>
                        <div class="sig-line">Principal Signature</div>
                    </div>
                    <div style="margin-top: 40px; font-size: 12px; text-align: center; color: #777;">
                        Note: Fee once paid is non-refundable. Please keep this receipt safe.
                    </div>
                </div>
                <script>window.print();<\/script>
            </body></html>`;
        }

        function printReceipt(student) {
            const className = classesCache.find(c => c.id === student.classId)?.name || '';
            const data = {
                name: student.name,
                rollNo: student.rollNo,
                className: className,
                month: new Date().toLocaleString('default', { month: 'long', year: 'numeric' }) + " Fee",
                amount: '____________'
            };
            const win = window.open('', '_blank');
            win.document.write(getReceiptHTML(data));
            win.document.close();
        }

        function printManualChallan() {
            const studentVal = document.getElementById('challan-student-select').value;
            const month = document.getElementById('challan-month').value;
            const amount = document.getElementById('challan-amount').value;
            
            let data = { month, amount };
            
            if (studentVal) {
                const s = JSON.parse(studentVal);
                data.name = s.name;
                data.rollNo = s.rollNo;
                data.className = classesCache.find(c => c.id === s.classId)?.name;
            }

            const win = window.open('', '_blank');
            win.document.write(getReceiptHTML(data));
            win.document.close();
        }

        // --- Payment Actions ---
        async function markAsPaid(studentId) {
            if (!confirm('Mark student as PAID manually?')) return;
            const batch = writeBatch(db);
            batch.update(doc(db, 'students', studentId), { feeStatus: 'Paid', lastPaymentDate: serverTimestamp() });
            batch.set(doc(collection(db, `students/${studentId}/paymentHistory`)), { amount: 'Manual', date: serverTimestamp(), method: 'Cash/Manual', status: 'Approved' });
            await batch.commit();
        }

        async function approvePayment(reqId, studentId) {
            if (!confirm('Approve this payment?')) return;
            const req = paymentRequestsCache.find(r => r.id === reqId);
            const batch = writeBatch(db);
            batch.update(doc(db, 'students', studentId), { feeStatus: 'Paid', lastPaymentDate: serverTimestamp() });
            batch.set(doc(collection(db, `students/${studentId}/paymentHistory`)), { amount: 'Online', date: req.submittedAt, method: 'Online', status: 'Approved', proofUrl: req.proofUrl });
            batch.delete(doc(db, 'paymentRequests', reqId));
            await batch.commit();
        }

        async function rejectPayment(reqId) {
            if (!confirm('Reject this request?')) return;
            await deleteDoc(doc(db, 'paymentRequests', reqId));
        }

        // --- Settings ---
        async function renderPaymentSettings() {
            const section = document.getElementById('payment-settings');
            const snap = await getDoc(doc(db, 'settings', 'payment'));
            const s = snap.exists() ? snap.data() : {};
            section.innerHTML = `
                <div class="bg-white p-8 rounded-lg shadow-xl fade-in max-w-2xl mx-auto">
                    <h2 class="text-3xl font-bold text-gray-800 mb-6">Payment Settings</h2>
                    <form id="payment-settings-form" class="space-y-4">
                        <div><label class="block text-sm font-medium text-gray-700">Easypaisa Title</label><input type="text" id="ep-title" class="w-full border rounded p-2" value="${s.easypaisaTitle||''}"></div>
                        <div><label class="block text-sm font-medium text-gray-700">Easypaisa Number</label><input type="text" id="ep-num" class="w-full border rounded p-2" value="${s.easypaisaNumber||''}"></div>
                        <div class="pt-4 border-t"></div>
                        <div><label class="block text-sm font-medium text-gray-700">Bank Name</label><input type="text" id="bk-name" class="w-full border rounded p-2" value="${s.bankName||''}"></div>
                        <div><label class="block text-sm font-medium text-gray-700">Account Title</label><input type="text" id="bk-title" class="w-full border rounded p-2" value="${s.bankTitle||''}"></div>
                        <div><label class="block text-sm font-medium text-gray-700">IBAN</label><input type="text" id="bk-iban" class="w-full border rounded p-2" value="${s.bankIban||''}"></div>
                        <button type="submit" class="w-full bg-blue-600 text-white py-2 rounded font-semibold hover:bg-blue-700 mt-4">Save Settings</button>
                    </form>
                </div>`;
            document.getElementById('payment-settings-form').addEventListener('submit', async (e) => {
                e.preventDefault();
                await setDoc(doc(db, 'settings', 'payment'), {
                    easypaisaTitle: document.getElementById('ep-title').value,
                    easypaisaNumber: document.getElementById('ep-num').value,
                    bankName: document.getElementById('bk-name').value,
                    bankTitle: document.getElementById('bk-title').value,
                    bankIban: document.getElementById('bk-iban').value
                }, {merge:true});
                alert('Settings Saved');
            });
        }

        function renderAnnouncements() {
            const el = document.getElementById('manage-announcements');
            el.innerHTML = `<div class="bg-white p-8 rounded-lg shadow-xl"><h2 class="text-3xl font-bold mb-4">Announcements</h2><div class="mb-4"><input id="ann-title" placeholder="Title" class="border p-2 mr-2"><input id="ann-content" placeholder="Content" class="border p-2 mr-2"><button id="save-ann" class="bg-blue-600 text-white p-2 rounded">Post</button></div><div class="space-y-2">${announcementsCache.map(a => `<div class="bg-gray-50 p-3 rounded flex justify-between"><span><b>${a.title}</b>: ${a.content}</span><button onclick="this.parentElement.remove(); deleteDoc(doc(db,'announcements','${a.id}'))" class="text-red-500">Del</button></div>`).join('')}</div></div>`;
            el.querySelector('#save-ann').onclick = async () => { await addDoc(collection(db, 'announcements'), { title: document.getElementById('ann-title').value, content: document.getElementById('ann-content').value, date: new Date().toISOString().split('T')[0] }); }
        }
        
        function renderBlogPosts() { document.getElementById('manage-blog').innerHTML = `<div class="bg-white p-8 rounded-lg shadow-xl"><h2 class="text-3xl font-bold mb-4">Blog Posts</h2><p class="text-gray-600">Total Posts: ${blogPostsCache.length}. Use the full editor to manage content.</p></div>`; }
        function renderAssignments() { document.getElementById('manage-assignments').innerHTML = `<div class="bg-white p-8 rounded-lg shadow-xl"><h2 class="text-3xl font-bold mb-4">Assignments</h2><p class="text-gray-600">Active Assignments: ${assignmentsCache.length}. Use Teacher Panel for detailed management.</p></div>`; }
    </script>
</body>
</html>
