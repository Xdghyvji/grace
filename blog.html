<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Grace Academy - Blog</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        .blog-card {
            transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
        }
        .blog-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }
        .pagination-link.active {
            background-color: #6B46C1; /* purple-700 */
            color: white;
            border-color: #6B46C1;
        }
    </style>
</head>
<body class="font-sans antialiased text-gray-800 bg-gray-50 flex flex-col min-h-screen">

    <header class="bg-white shadow-md">
        <nav class="container mx-auto px-6 py-4 flex justify-between items-center">
            <div class="flex items-center space-x-3">
                <img src="https://placehold.co/50x50/800080/FFFFFF?text=GA" alt="Academy Logo" class="h-10 w-auto">
                <a href="index.html" class="text-2xl font-bold text-purple-900 hover:text-purple-700">The Grace Academy</a>
            </div>
            <div class="hidden md:flex items-center space-x-6">
                <a href="index.html" class="text-gray-700 hover:text-purple-700 text-lg font-medium">Home</a>
                <a href="blog.html" class="text-purple-700 border-b-2 border-purple-700 text-lg font-medium">Blog</a>
                <a href="index.html#contact" class="text-gray-700 hover:text-purple-700 text-lg font-medium">Contact</a>
                <a href="login.html" class="bg-purple-600 hover:bg-purple-700 text-white px-5 py-2 rounded-lg font-medium transition duration-300">Login</a>
            </div>
            <div class="md:hidden">
                <button id="mobile-menu-button" class="text-gray-800 hover:text-purple-700 focus:outline-none">
                    <svg class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                    </svg>
                </button>
            </div>
        </nav>
        <div id="mobile-menu" class="md:hidden hidden bg-white shadow-lg py-2">
            <a href="index.html" class="block px-6 py-2 text-gray-700 hover:bg-gray-100">Home</a>
            <a href="blog.html" class="block px-6 py-2 text-purple-700 bg-purple-50">Blog</a>
            <a href="index.html#contact" class="block px-6 py-2 text-gray-700 hover:bg-gray-100">Contact</a>
            <a href="login.html" class="block px-6 py-2 text-purple-600 hover:bg-purple-50">Login</a>
        </div>
    </header>

    <main class="flex-1 container mx-auto px-6 py-12">
        <h1 class="text-5xl font-extrabold text-center text-purple-900 mb-12">Our Academy Blog</h1>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-10" id="blog-posts-container">
            <!-- Loading placeholder -->
             <p class="text-center col-span-3 text-gray-500 text-lg">Loading blog posts...</p>
        </div>

        <div class="flex justify-center mt-12">
            <nav class="flex items-center space-x-2" id="pagination-container">
                <!-- Pagination will be rendered here -->
            </nav>
        </div>
    </main>

    <footer class="bg-gray-800 text-white py-10 mt-12">
        <div class="container mx-auto px-6 text-center">
            <p>&copy; <span id="current-year"></span> The Grace Academy. All rights reserved.</p>
            <div class="flex justify-center space-x-6 mt-4">
                <a href="#" class="text-gray-400 hover:text-white"><i class="fab fa-facebook-f"></i></a>
                <a href="#" class="text-gray-400 hover:text-white"><i class="fab fa-twitter"></i></a>
                <a href="#" class="text-gray-400 hover:text-white"><i class="fab fa-instagram"></i></a>
                <a href="#" class="text-gray-400 hover:text-white"><i class="fab fa-linkedin-in"></i></a>
            </div>
        </div>
    </footer>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getFirestore, collection, getDocs, query, orderBy } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // IMPORTANT: These variables are provided by the environment and MUST be used.
        const firebaseConfig = {
  apiKey: "AIzaSyA65vwfeuvsxnVSmlTof1_khaPmNtiMMv0",
  authDomain: "non-ruled.firebaseapp.com",
  projectId: "non-ruled",
  storageBucket: "non-ruled.firebasestorage.app",
  messagingSenderId: "981177762303",
  appId: "1:981177762303:web:7db5c95c3b264444e267ca",
  measurementId: "G-E3TY5JLVT5"
};
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        const postsPerPage = 6;
        let currentPage = 1;
        let allBlogPosts = [];

        const blogPostsContainer = document.getElementById('blog-posts-container');
        const paginationContainer = document.getElementById('pagination-container');

        async function fetchBlogPosts() {
            try {
                // CORRECTED FIRESTORE PATH: Using the consistent path structure
                const postsCollection = collection(db, `artifacts/${appId}/public/data/blogPosts`);
                // Note: Firestore requires an index on the 'date' field for this query to work.
                const q = query(postsCollection, orderBy("date", "desc"));
                const querySnapshot = await getDocs(q);
                allBlogPosts = querySnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                renderPage(currentPage);
            } catch (error) {
                console.error("Error fetching blog posts:", error);
                blogPostsContainer.innerHTML = `<p class="text-center col-span-3 text-red-500 text-lg">Failed to load blog posts. Please check the console for errors.</p>`;
            }
        }

        function renderPage(page) {
            currentPage = page;
            blogPostsContainer.innerHTML = '';
            paginationContainer.innerHTML = '';

            if (allBlogPosts.length === 0) {
                blogPostsContainer.innerHTML = `<p class="text-center col-span-3 text-gray-600 text-lg">No blog posts have been published yet.</p>`;
                return;
            }

            const startIndex = (page - 1) * postsPerPage;
            const endIndex = page * postsPerPage;
            const paginatedPosts = allBlogPosts.slice(startIndex, endIndex);

            paginatedPosts.forEach(post => {
                const postElement = document.createElement('div');
                postElement.className = 'blog-card bg-white rounded-lg shadow-lg overflow-hidden flex flex-col';
                postElement.innerHTML = `
                    <a href="single-blog.html?id=${post.id}" class="block">
                        <img src="${post.imageUrl || 'https://placehold.co/600x400/800080/FFFFFF?text=Blog+Post'}" alt="${post.title}" class="w-full h-56 object-cover">
                    </a>
                    <div class="p-6 flex flex-col flex-1">
                        <p class="text-purple-600 font-semibold text-sm mb-2">${post.category || 'General'}</p>
                        <h3 class="text-2xl font-bold text-gray-900 mb-3 flex-1">
                            <a href="single-blog.html?id=${post.id}" class="hover:text-purple-700">${post.title}</a>
                        </h3>
                        <p class="text-gray-600 mb-4">${post.excerpt || post.content.substring(0, 100) + '...'}</p>
                        <div class="flex items-center text-sm text-gray-500 mt-auto">
                            <i class="fas fa-user-circle mr-2"></i>
                            <span>${post.author || 'Admin'}</span>
                            <span class="mx-2">&bull;</span>
                            <i class="fas fa-calendar-alt mr-2"></i>
                            <span>${new Date(post.date).toLocaleDateString()}</span>
                        </div>
                    </div>
                `;
                blogPostsContainer.appendChild(postElement);
            });

            renderPagination();
        }

        function renderPagination() {
            const totalPages = Math.ceil(allBlogPosts.length / postsPerPage);
            if (totalPages <= 1) return;

            // Previous button
            paginationContainer.innerHTML += `
                <button onclick="changePage(${currentPage - 1})" class="pagination-link px-4 py-2 border rounded-md bg-white hover:bg-gray-100 ${currentPage === 1 ? 'opacity-50 cursor-not-allowed' : ''}" ${currentPage === 1 ? 'disabled' : ''}>
                    &laquo; Prev
                </button>`;

            // Page numbers
            for (let i = 1; i <= totalPages; i++) {
                paginationContainer.innerHTML += `
                    <button onclick="changePage(${i})" class="pagination-link px-4 py-2 border rounded-md ${i === currentPage ? 'active' : 'bg-white hover:bg-gray-100'}">
                        ${i}
                    </button>`;
            }

            // Next button
            paginationContainer.innerHTML += `
                <button onclick="changePage(${currentPage + 1})" class="pagination-link px-4 py-2 border rounded-md bg-white hover:bg-gray-100 ${currentPage === totalPages ? 'opacity-50 cursor-not-allowed' : ''}" ${currentPage === totalPages ? 'disabled' : ''}>
                    Next &raquo;
                </button>`;
        }
        
        window.changePage = function(page) {
            renderPage(page);
        }
        
        document.addEventListener('DOMContentLoaded', fetchBlogPosts);
        document.getElementById('current-year').textContent = new Date().getFullYear();
        document.getElementById('mobile-menu-button').addEventListener('click', () => {
            document.getElementById('mobile-menu').classList.toggle('hidden');
        });
    </script>
</body>
</html>
